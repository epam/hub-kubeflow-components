version: 1
kind: component

requires:
- kubernetes
- helm

parameters:
- name: bucket
  parameters:
  - name: accessKey
  - name: secretKey
  - name: region
    value: us-east-1
  - name: name
    value: default
  - name: acl
    brief: see more https://min.io/docs/minio/linux/administration/identity-access-management/policy-based-access-control.html
    value: none

- name: storage
  empty: allow
  parameters:
  - name: class
  - name: claim
  - name: size
    value: 20Gi

- name: kubernetes
  parameters:
  - name: namespace
    value: minio
    env: NAMESPACE
  - name: replicas
    value: 4
  - name: requests
    value: >-
      memory=1Gi

- name: minio
  parameters:
  - name: mode
    value: "#{kubernetes.replicas >= 4 ? 'distributed' : 'standalone'}"
  - name: logLevel
    value: info

- name: helm
  parameters:
  - name: repo
    value: https://charts.min.io/
    env: HELM_REPO
  - name: chart
    env: HELM_CHART
    value: minio
  - name: version
    value: 5.0.15
    env: HELM_CHART_VERSION

- name: minio
  parameters:
  - name: server.image
    value: quay.io/minio/minio
  - name: server.tag
    value: RELEASE.2024-01-11T07-46-16Z
  - name: client.mage
    value: quay.io/minio/mc
  - name: client.tag
    value: RELEASE.2024-01-11T05-49-32Z

- name: ingress
  empty: allow
  parameters:
  - name: protocol
    value: http
  - name: hosts
    empty: allow
  - name: class

- name: nginx
  empty: allow
  parameters:
  - name: uploadTimeout
    value: "1800"
  - name: readTimeout
    value: "1800"
  - name: fileSize
    empty: allow
    value: 640m

outputs:
- name: bucket.kind
  value: minio
- name: bucket.name
- name: bucket.region
- name: bucket.endpoint
  value: http://minio.${kubernetes.namespace}.svc:9000
- name: minio.mode

templates:
  kind: go
  files:
  - "*.gotemplate"
