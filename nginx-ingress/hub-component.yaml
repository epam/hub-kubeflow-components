---
version: 1
kind: component

requires:
- kubernetes
- helm

provides:
- ingress

parameters:
- name: hub.componentName
- name: ingress
  parameters:
  - name: class
    value: nginx
    env: INGRESS_CLASS
  - name: defaultClass
    value: "${ingress.class}"

- name: kubernetes
  parameters: 
  - name: namespace
    value: kube-ingress
    env: NAMESPACE
  - name: replicas
    value: 1
  - name: service.type
    value: LoadBalancer
  - name: requests
    empty: allow
    # these values are default in the helm chart
    value: >-
      cpu=100m
      memory=128Mi
  - name: limits
    empty: allow
  - name: service.externalTrafficPolicy
    value: Cluster
  - name: service.loadBalancerSourceRanges
    empty: allow
  - name: service.annotations
    empty: allow
- name: nginx.controller
  parameters: 
  - name: features
    value: snippets
  - name: kind
    value: deployment

- name: helm
  parameters:
  - name: chart
    value: "nginx-ingress"
    env: HELM_CHART
  - name: repo
    value: https://helm.nginx.com/stable
    env: HELM_REPO
  - name: version
    value: 1.0.0
    env: HELM_CHART_VERSION
  - name: valuesFile
    value: values.yaml
    env: CHART_VALUES_FILE
ouptuts:
- name: ingress.class
- name: ingress.defaultClass

templates:
  kind: go
  files: ["*.gotemplate"]
