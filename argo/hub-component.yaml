version: 1
kind: component

requires:
  - kubernetes
  - helm

parameters:
  - name: ingress
    parameters:
      - name: protocol
        value: http
      - name: hosts
        empty: allow
        env: INGRESS_HOSTS

  - name: kubernetes
    parameters:
      - name: namespace
        value: argo
        env: NAMESPACE

  - name: argo
    parameters:
      - name: workflowNamespace
        value: ${kubernetes.namespace}
      - name: version
        value: v3.4.10
      - name: executor
        parameters:
          - name: registry
            value: "quay.io"
          - name: repository
            value: "argoproj/argoexec"
          - name: tag
            value: ${argo.version}

  - name: helm
    parameters:
      - name: repo
        env: HELM_REPO
        value: https://argoproj.github.io/argo-helm
      - name: chart
        value: argo-workflows
        env: HELM_CHART
      - name: version
        value: 0.33.1
        env: HELM_CHART_VERSION
      - name: valuesFile
        value: values.yaml
        env: CHART_VALUES_FILE

  - name: bucket
    empty: allow
    parameters:
      - name: endpoint
      - name: port
      - name: region
      - name: accessKey
      - name: secretKey
      - name: name
        env: BUCKET_NAME

  - name: azure.storageAccount
    empty: allow
    parameters:
      - name: name
        env: AZURE_STORAGE_ACCOUNT_NAME
      - name: containerName
      - name: accessKey

  - name: hub.backup.file
    empty: allow
    env: BACKUP_FILE

templates:
  files:
    - "*.template"
  extra:
    - kind: go
      files:
        - "*.gotemplate"
        - "resources/*.gotemplate"
