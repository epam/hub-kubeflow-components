version: 1
kind: component

requires:
  - helm
  - kubernetes

provides:
  - cert-manager

parameters:
  - name: kubernetes
    parameters:
    - name: namespace
      value: kube-system
      env: NAMESPACE
    - name: serviceAccount
      empty: allow
    - name: controller.replicas
      value: 1
    - name: cainjector.replicas
      value: 1
    - name: webhook.replicas
      value: 1

  - name: certmanager
    parameters:
      - name: version
        value: v1.12.7
        env: HELM_CHART_VERSION
      - name: controller
        parameters:
          - name: image.repository
            value: quay.io/jetstack/cert-manager-controller
          - name: image.tag
            value: ${certmanager.version}
      - name: webhook
        parameters:
          - name: image.repository
            value: quay.io/jetstack/cert-manager-webhook
          - name: image.tag
            value: ${certmanager.version}
      - name: cainjector
        parameters:
          - name: image.repository
            value: quay.io/jetstack/cert-manager-cainjector
          - name: image.tag
            value: ${certmanager.version}
      - name: startupapicheck
        parameters:
          - name: image.repository
            value: quay.io/jetstack/cert-manager-ctl
          - name: image.tag
            value: ${certmanager.version}

  - name: helm
    parameters:
      - name: repo
        value: https://charts.jetstack.io
        env: HELM_REPO
      - name: chart
        env: HELM_CHART
        value: "cert-manager"
      - name: crd
        env: CRD
        value: https://github.com/jetstack/cert-manager/releases/download/${certmanager.version}/cert-manager.crds.yaml

templates:
  kind: go
  files:
  - "*.gotemplate"
