---
version: 1
kind: component

requires:
  - kubernetes
  - helm

provides:
  - seldon

lifecycle:
  verbs:
    - deploy
    - undeploy

parameters:
  - name: hub.componentName
  - name: kubeflow.name
    value: kubeflow
  - name: kubernetes.namespace
    value: seldon-system
    env: NAMESPACE

  - name: seldon
    parameters:
      - name: version
        value: 1.14.1
        env: HELM_CHART_VERSION

  - name: helm
    parameters:
      - name: chart
        value: seldon-core-operator
        env: HELM_CHART
      - name: repo
        value: https://storage.googleapis.com/seldon-charts
        env: HELM_REPO
      - name: valuesFile
        value: values.yaml
        env: CHART_VALUES_FILE

  - name: ingress
    parameters:
      - name: hosts
      - name: protocol

  - name: istio
    parameters:
      - name: namespace
        value: istio-system
      - name: ingressGateway
        value: istio-ingressgateway
        env: INGRESS_GATEWAY
      - name: gateway.name
        value: "${hub.componentName}"
      - name: gateway.hosts
        env: HOSTS
        value: |
          ${istio.ingressGateway}.${istio.namespace}.svc.cluster.local

outputs:
  - name: seldon.istioGateway
    brief: Default istio gateway for seldon deployments
    value: ${kubernetes.namespace}/${hub.componentName}-gateway
templates:
  files:
    - "*.template"
