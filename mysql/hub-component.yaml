---
version: 1
kind: component

requires:
  - kubernetes
  - helm

parameters:
- name: storage.class
  empty: allow
- name: storage.size
  value: 8Gi
- name: kubernetes
  parameters:
  - name: namespace
    value: mysql
    env: NAMESPACE
  - name: replicas
    value: 2
- name: mysql
  empty: allow
  parameters:
  - name: port
    value: 3306
  - name: user
    value: mysql
    env: DB_USER
  - name: password
    env: DB_PASSWORD
  - name: database
    env: DB_NAME
  - name: rootPassword
    env: MYSQL_ROOT_PASSWORD
  - name: extra.databases
    empty: allow
    env: EXTRA_DATABASES

- name: helm
  parameters:
  - name: repo
    value: https://charts.bitnami.com/bitnami
    env: HELM_REPO
  - name: chart
    value: mysql
    env: HELM_CHART
  - name: version
    value: 9.11.2
    env: HELM_CHART_VERSION
  - name: valuesFile
    value: values.yaml
    env: CHART_VALUES_FILE
- name: hub.backup.file
  empty: allow
  env: BACKUP_FILE

outputs:
- name: mysql.host
  value: ${hub.componentName}.${kubernetes.namespace}.svc.cluster.local
- name: mysql.port
- name: mysql.database
- name: mysql.user
- name: mysql.password
  kind: secret
- name: mysql.rootPassword
  kind: secret

templates:
  files: ["*.template"]
  extra:
  - kind: go
    files: ["*.gotemplate"]
