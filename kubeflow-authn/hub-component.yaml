version: 1
kind: component

requires:
  - kubernetes

parameters:
  # Kubeflow protocol and host
  - name: ingress
    parameters:
      - name: protocol
        value: http
      - name: hosts

  - name: oidc.issuer

  - name: kubernetes.namespace
    value: istio-system
    env: NAMESPACE

  - name: storage.size
    value: 10Gi

  - name: istio.ingressGateway.labels

  - name: kubeflow
    parameters:
      - name: version
        value: v1.6.1
        env: VERSION
      - name: authn
        parameters:
          - name: afterLogin
            value: ${ingress.protocol}://${ingress.hosts}
            # OIDC auth url, must be external to the cluster
          - name: oidcAuthUrl
            value: ${oidc.issuer}/auth
          - name: oidcProvider
            value: ${oidc.issuer}
          - name: oidcRedirectURI
            value: ${ingress.protocol}://${ingress.hosts}/login/oidc
            env: OIDC_REDIRECT_URI
          - name: oidcClientId
            value: kubeflow-client
            env: OIDC_CLIENT_ID
          - name: oidcSecret
            value: OpenID connect client mutual trust secret between oidc and Kubeflow
            env: OIDC_SECRET
          - name: sessionMaxAge
            value: 86400

  - name: kustomize
    parameters:
      - name: tarball.url
        value: "https://github.com/kubeflow/manifests/archive/${kubeflow.version}.tar.gz"
        env: HUB_KUSTOMIZE_TARBALL_URL
      - name: subpath
        value: common/oidc-authservice/base
        env: HUB_KUSTOMIZE_TARBALL_SUBPATH

templates:
  kind: go
  files:
    - "*.gotemplate"
