---
version: 1
kind: component

requires:
  - kubernetes

parameters:
- name: dns.domain
  env: HUB_DOMAIN_NAME
- name: dex.api.endpoint
- name: dex.issuer
  value: ${component.ingress.protocol}://auth.${dns.domain}
- name: component.ingress.protocol
  value: https
- name: component.istio
  parameters:
  - name: namespace
    value: istio-system
    env: NAMESPACE
  - name: ingressGateway
    value: istio-ingressgateway
- name: component.kubeflow
  parameters:
  - name: version
    value: v1.5.1
    env: VERSION
  - name: authn.oidcProvider
    value: ${dex.issuer}
  - name: authn.oidcRedirectURI
    value: https://kubeflow.${dns.domain}/login/oidc
  - name: authn.oidcClientId
    value: kubeflow-client
  - name: authn.afterLogin
    value: ${component.ingress.protocol}://kubeflow.${dns.domain}
  - name: authn.oidcSecret
    value: OpenID connect client mutual trust secret between Dex and Kubeflow
  - name: authn.sessionMaxAge
    value: 86400
  - name: authn.volumeSize
    value: 10Gi    
  - name: kustomize.tarball
    value: "https://github.com/kubeflow/manifests/archive/${component.kubeflow.version}.tar.gz"
    env: HUB_KUSTOMIZE_TARBALL_URL
  - name: kustomize.subpath
    value: common/oidc-authservice
    env: HUB_KUSTOMIZE_TARBALL_SUBPATH

templates:
  files:
  - "*.template"
